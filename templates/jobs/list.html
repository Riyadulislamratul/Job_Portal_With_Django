{% extends "base.html" %}

{% block title %}
Job Opportunities
{% endblock title %}

{% block content %}

<div class="mb-10 flex flex-col md:flex-row justify-between md:items-center gap-6">
  <div>
    <h1 class="text-4xl font-extrabold text-green-800">Explore Opportunities</h1>
    <p class="text-green-600 mt-1">Find roles that match your ambitions</p>
  </div>

  {% if user.is_authenticated and user.user_type == 'RECRUITER' %}
    <a href="{% url 'job_create' %}"
       class="bg-green-700 text-white px-8 py-3 rounded-xl hover:bg-green-800 font-bold self-start">
      Post New Job
    </a>
  {% endif %}
</div>

<div class="bg-green-50 border border-green-200 rounded-2xl p-6 mb-10 shadow">
  <div class="flex flex-col md:flex-row gap-4 items-stretch md:items-center">

    <form method="get" class="flex flex-1 gap-3">
      <input type="text" name="q" value="{{ query }}"
        placeholder="Search by title, skill, or keyword"
        class="flex-1 rounded-lg border border-green-300 p-3 focus:outline-none focus:ring-2 focus:ring-green-500">

      {% if view_type == 'matched' %}
        <input type="hidden" name="view" value="matched">
      {% endif %}

      <button type="submit"
        class="bg-green-700 text-white px-8 py-3 rounded-lg hover:bg-green-800 font-bold">
        Search
      </button>
    </form>

    {% if show_skill_match %}
      <a href="?view=matched{% if query %}&q={{ query }}{% endif %}"
         class="{% if view_type == 'matched' %}
           bg-green-700 text-white
         {% else %}
           bg-green-200 text-green-800
         {% endif %}
         px-8 py-3 rounded-lg font-bold text-center hover:bg-green-600 whitespace-nowrap">
        Skill Matches
      </a>
    {% endif %}
  </div>

  <p class="text-sm text-green-700 mt-4 font-medium">
    {% if view_type == 'matched' %}
      Showing roles aligned with your skills
    {% else %}
      Showing all available roles
    {% endif %}
  </p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  {% for job in jobs %}
    <div class="bg-white border border-green-200 rounded-2xl shadow hover:shadow-lg transition overflow-hidden">
      <div class="p-6">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h2 class="text-2xl font-bold text-green-800">{{ job.title }}</h2>
            <p class="text-sm text-green-600 font-medium">
              {{ job.recruiter.recruiterprofile.company_name|default:"Company" }}
            </p>
          </div>

          {% if job.company_logo %}
            <img src="{{ job.company_logo.url }}" class="h-12 w-12 rounded-lg object-cover">
          {% endif %}
        </div>

        <div class="flex flex-wrap gap-3 text-sm mb-4">
          <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full font-semibold">
            {{ job.openings }} Openings
          </span>
          <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full font-semibold">
            {{ job.skills }}
          </span>
        </div>

        <p class="text-gray-700 mb-5 leading-relaxed">
          {{ job.description|truncatechars:140 }}
        </p>

        <a href="{% url 'job_detail' job.id %}"
           class="inline-flex items-center text-green-700 font-bold hover:text-green-800">
          View Job Details â†’
        </a>
      </div>
    </div>
  {% empty %}
    <div class="col-span-full bg-green-50 border border-green-200 rounded-xl p-12 text-center">
      <p class="text-green-700 font-medium text-lg">
        No jobs found matching your criteria
      </p>
    </div>
  {% endfor %}
</div>

{% endblock %}
